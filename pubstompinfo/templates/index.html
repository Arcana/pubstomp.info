{% extends "layout.html" %}
{% from "macros.html" import logo %}

{% block content %}
    <div class="hero">
        <div class="hero-inner">
            <a href="{{ url_for('index') }}" class="hero-logo">{{ logo() }}</a>

            <div class="hero-copy">
                <h1>Find nearby pubstomps!</h1>

                <p>Find pubstomps for any league near you! Also come up with better copy.</p>

                <p>On-going and upcoming events:</p>

                <div id="pubstomp-map" class="google-map" style="height: 500px;"></div>

                <p>TODO: Search button for city/tournament</p>
            </div>
        </div>
    </div>

    <section>
        <p>Copy copy copy copy</p>
        <p>Copy copy copy copy</p>
    </section>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script type="text/javascript"
            src="//maps.googleapis.com/maps/api/js?key={{ config['GMAPS_API_KEY'] }}">
    </script>
    <script type="text/javascript">
        function initialize() {
            var mapOptions = {
                zoom: 2,
                center: {lat: 40, lng: 0}  // Doesn't work without a center ;(
            };
            var map = new google.maps.Map(document.getElementById("pubstomp-map"), mapOptions);
            var markers = {},
                infowindows = {};

            {% for event in events %}
                markers[{{ loop.index }}] = new google.maps.Marker({
                    map: map,
                    position: {
                        lat: {{ event.city.latitude }},
                        lng: {{ event.city.longitude }}
                    },
                    title: "{{ event.name }}"

                });

                infowindows[{{ loop.index }}] = new google.maps.InfoWindow({
                    content: '<div class="info-window">' +
                            '<dl>' +
                            '<dt>Event name</dt>' +
                            '<dd><a href="{{ url_for("events.event", _id=event.id) }}">{{ event.name }}</a></dd>' +
                            '<dt>City</dt>' +
                            '<dd><a href="{{ url_for('geo.city', _id=event.city.geonameid) }}">{{ event.city }}</a></dd>' +
                            '<dt>League</dt>' +
                            '<dd><a href="{{ url_for('leagues.league', _id=event.league.id) }}">{{ event.league.name }}</a></dd>' +
                            '</dl>' +
                            '</div>' +
                            '<a class="button" href="{{ url_for("events.event", _id=event.id) }}">View event</a>'
                });


                google.maps.event.addListener(
                        markers[{{ loop.index }}],
                        'click',
                        function(e){
                            infowindows[{{ loop.index }}].open(map, markers[{{ loop.index }}]);
                        }
                );
            {% endfor %}
        }
        google.maps.event.addDomListener(window, 'load', initialize);
    </script>
{% endblock %}
